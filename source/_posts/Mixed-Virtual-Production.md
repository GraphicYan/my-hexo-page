---
title: 混合虚拟制片
layout: Mixed Virtual Production
toc: true
top: true
date: 2022/12/29 14:23:29
---

## 原创性声明
本文为作者原创，在个人Blog首次发布，如需转载请注明引用出处。（yanzhang.cg@gmail.com 或 https://graphicyan.github.io/）

<a name="FpCHr"></a>
## 1 引言
<a name="OghkJ"></a>
### 1.1 虚拟制片
<a name="Hdwct"></a>
#### 1.1.1 混合虚拟制片
混合虚拟制片是一种通过摄像机追踪将绿幕摄影与CG元素合成的技术，可为摄影导<br />演和摄影助理提供实时预览，并在后期制作阶段中完善；也可直接作为摄像机的最<br />终画面。这类虚拟制片已在现场直播中使用了一段时间，特别是在体育节目中，不<br />过越来越多的专题片和连播片也在应用该技术。混合虚拟制片的两种主要模式是实<br />时制作和后期制作。<br />绿幕中的实时混合虚拟制片最早出现在广播新闻天气预报中，天气预报员通过色键<br />技术与天气预报图像融为一体。这类效果通常差强人意，摄像机是固定的，而且质<br />量不可能达到电影级水准。尽管如此，近年来随着GPU速度的提升和实时引擎的引<br />入，这类解决方案的质量有了很大提高。例如，Zero Density系统利用虚幻引擎制作<br />各种新闻和娱乐节目的现场合成效果。将Zero Density用于演播室内实时虚拟制片的<br />用户包括福克斯体育、Canal +、RTL、TF1和天空新闻。<br />在拍摄绿幕时，后期制作类型的混合虚拟制片可使用摄像机跟踪数据，从而提供实<br />时的镜头内合成图像。实时合成通常使用代理分辨率。在绿幕前捕捉/拍摄演员和道<br />具时，它通常用作勾画镜头的参照。后期制作类型的混合虚拟制片旨在帮助导演、<br />摄影导演和摄影助理更好地掌握虚拟元素（例如 CG角色的位置）并设置扩展，以便<br />在后期中更好地集成视觉特效。《奇幻森林》在制作时采用了该方法的高级版本。<br />这种技术还广泛应用于最近的电视连续剧中，例如《复仇》、《泛美航空》、《童<br />话镇》以及《美国众神》。<br />![image.png](assets/post_images/Mixed-Virtual-Production/image_000.png#clientId=ubddb27b3-df19-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=650&id=Hql4I&margin=%5Bobject%20Object%5D&name=image.png&originHeight=650&originWidth=909&originalType=binary&ratio=1&rotation=0&showTitle=false&size=627633&status=done&style=none&taskId=u11e864b5-03c2-4425-8405-e629bcd0d23&title=&width=909)
<a name="OK3M0"></a>
#### 1.1.2 应用场景
![image.png](assets/post_images/Mixed-Virtual-Production/image_001.png#clientId=u5a6f63bb-8cfc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=213&id=u61741d30&margin=%5Bobject%20Object%5D&name=image.png&originHeight=503&originWidth=755&originalType=binary&ratio=1&rotation=0&showTitle=false&size=590437&status=done&style=none&taskId=u8e4870e9-1d33-4398-98eb-d51af2cf2b0&title=&width=319.5)![image.png](assets/post_images/Mixed-Virtual-Production/image_002.png#clientId=u5a6f63bb-8cfc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=214&id=u28101a6f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=393&originWidth=755&originalType=binary&ratio=1&rotation=0&showTitle=false&size=433553&status=done&style=none&taskId=u237d6df6-9d54-4404-9a37-70708d3fc6f&title=&width=411.5)<br />![image.png](assets/post_images/Mixed-Virtual-Production/image_003.png#clientId=u8c606a1b-79ba-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=272&id=ub1cb421e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1076&originWidth=2890&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2732989&status=done&style=none&taskId=u6f882e4e-4942-45f2-bef0-7ff90e61f42&title=&width=730)<br />![image.png](assets/post_images/Mixed-Virtual-Production/image_004.png#clientId=u8c606a1b-79ba-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=498&id=uf24894e6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1128&originWidth=1650&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2146673&status=done&style=none&taskId=u6fbf0a06-9f9c-4e78-9b69-4d0d699561b&title=&width=729)

<a name="CGWVE"></a>
#### 1.1.3 工作流特性
<a name="lXoax"></a>
assets/post_images/Mixed-Virtual-Production/image_008.assets/post_images/Mixed-Virtual-Production/image_007.assets/post_images/Mixed-Virtual-Production/image_006.assets/post_images/Mixed-Virtual-Production/image_005.#### ![image.png](assets/post_images/Mixed-Virtual-Production/image_009.png#clientId=ubddb27b3-df19-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1033&id=u314e8537&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1549&originWidth=1345&originalType=binary&ratio=1&rotation=0&showTitle=false&size=839245&status=done&style=none&taskId=uf404c7c6-b333-4201-8bdd-b0fe8f96074&title=&width=896.6666666666666)
<a name="vwKhS"></a>
### 1.2 关键词
<a name="ZiLol"></a>
#### 1.2.1 绿幕（Green Screen）
理论上可以是任何颜色的单色背景，使其在处理后为透明或者从拍摄中除去。通常是亮绿色（bright green），因为其与人体皮肤距离最远。
<a name="yWgK6"></a>
#### 1.2.2 色键技术（Chroma Key）
基于色调（hue）对图片做分层或合成。
<a name="Eq7fK"></a>
#### 1.2.3 抠图（Keying）
使用视频编辑软件在后处理阶段移除绿幕背景。
<a name="y3sIx"></a>
#### 1.2.4 溢色（Spill）
来自绿幕反射的有色光达到主物体上而产生，影响抠图阶段，需用各种手段来抑制。
<a name="QGp6c"></a>
### 1.3 关键要素
<a name="VR6i3"></a>
#### 1.3.1 正确的绿
用非反射材质的绿幕（棉优于尼龙），最好是 chorma key green 或者 digi green。偶尔也需要用到蓝幕，取决于想要拍摄的场景：[blue screen vs green screen](https://www.premiumbeat.com/blog/blue-screen-vs-green-screen/)。
<a name="pWiUx"></a>
#### 1.3.2 主体和背景要分开
最好保持主体距离绿幕6英尺以上（1.8m），这能很大程度降低溢色、避免不想要的阴影投射在绿幕上。
<a name="tuTh3"></a>
#### 1.3.3 输入决定成败（RAW is King）
尽可能使用越高的比特率视频、最少压缩的编解码器。10bit颜色由于8bit，ProRes442/444或者最好RAW格式的输入。
<a name="OItsU"></a>
#### 1.3.4 光要打好
前景、背景要分开打光，绿幕背景的打光要尽可能的均匀。
<a name="trLIl"></a>
#### 1.3.5 处理动态模糊
使用尽可能高的快门速度来减少动态模糊，有助于创造更加纯净的抠图。但在后处理时，要把动态模糊加回来。
<a name="q65c4"></a>
#### 1.3.6 用专业的抠图软件
Ae、Pr、HitFilm各种后期软件，还有开源的专业抠图软件比如[DaVinci Resolve](http://www.blackmagicdesign.com/products/davinciresolve/fusion)。

<a name="wfiAO"></a>
## 2 系统配置与实现
<a name="WimVy"></a>
### 2.1 整体框架
<a name="aZhfl"></a>
#### 2.1.1 流程参考
[https://www.youtube.com/watch?v=lRQvi5Jc_Js](https://www.youtube.com/watch?v=lRQvi5Jc_Js)
<a name="WvvEu"></a>
#### 2.1.2 系统框图
![混合虚拟制片图.jpg](assets/post_images/Mixed-Virtual-Production/image_010.jpeg#clientId=u477df368-560d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=321&id=u0b847d58&margin=%5Bobject%20Object%5D&name=%E6%B7%B7%E5%90%88%E8%99%9A%E6%8B%9F%E5%88%B6%E7%89%87%E5%9B%BE.jpg&originHeight=642&originWidth=1524&originalType=binary&ratio=1&rotation=0&showTitle=false&size=132445&status=done&style=none&taskId=u1f53aa12-b2ff-484f-a67d-97400a24841&title=&width=762)
<a name="YKK78"></a>
### 2.2 配置绿幕
<a name="v4bSh"></a>
#### 2.2.1 绿幕整套装备
![image.png](assets/post_images/Mixed-Virtual-Production/image_011.png#clientId=u5a6f63bb-8cfc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=292&id=i4AjS&margin=%5Bobject%20Object%5D&name=image.png&originHeight=584&originWidth=755&originalType=binary&ratio=1&rotation=0&showTitle=false&size=408292&status=done&style=none&taskId=u42c8414e-ecb8-416f-91dd-e5ed8eab31a&title=&width=377.5)<br />Neewer green screen kit（190 dollars）<br />This massive package boasts a 6×9 screen that includes a white and black backdrop, an 8.5×10 stand support system, six clamps, four light stands, two umbrellas, two softboxes, four daylight bulbs, and bags to carry the kit around.
<a name="BpB85"></a>
#### 2.2.2 DIY
[New Rules of Greenscreen](https://youtu.be/PDJsKiaKmAE)

- 绿幕：工艺布料、彩色泡沫板、墙体刷漆（哑光漆）。
- 灯光：分开打光、柔和、减少反射、LED更佳。
- 支架：稳定、平整。

![image.png](assets/post_images/Mixed-Virtual-Production/image_012.png#clientId=u5a6f63bb-8cfc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=200&id=cf36g&margin=%5Bobject%20Object%5D&name=image.png&originHeight=400&originWidth=755&originalType=binary&ratio=1&rotation=0&showTitle=false&size=136058&status=done&style=none&taskId=u2fa777ed-d48f-4df2-8155-f9f1c61a44d&title=&width=377.5)<br />（参考[EMART Kit](https://www.amazon.com/Photography-Backdrop-Continuous-Chromakey-Background/dp/B075VM76MV/ref=sr_1_1_sspa)）
<a name="LkPt3"></a>
### 2.3 硬件配置
<a name="Dbt2j"></a>
#### 2.3.1 硬件需要

- Vive Tracker

![image.png](assets/post_images/Mixed-Virtual-Production/image_013.png#clientId=ub8cf7548-2ac3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=227&id=uf9b416ae&margin=%5Bobject%20Object%5D&name=image.png&originHeight=746&originWidth=1502&originalType=binary&ratio=1&rotation=0&showTitle=false&size=689244&status=done&style=none&taskId=u202e5cce-4e17-446c-9eb2-e9bd10c3350&title=&width=458)

- Video I/O Card（专业级）

![image.png](assets/post_images/Mixed-Virtual-Production/image_014.png#clientId=ub8cf7548-2ac3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=336&id=ufdf99058&margin=%5Bobject%20Object%5D&name=image.png&originHeight=672&originWidth=924&originalType=binary&ratio=1&rotation=0&showTitle=false&size=557760&status=done&style=none&taskId=u1bba402b-eae6-40d1-a1c1-04ab48dc53b&title=&width=462)
<a name="IBVqC"></a>
#### 2.3.2 场地配置

- 确定场地尺寸
- 结合虚拟勘景
- 推算所需绿幕尺寸
- 布置现场

![image.png](assets/post_images/Mixed-Virtual-Production/image_015.png#clientId=u5a6f63bb-8cfc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=459&id=u68abbdc1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=918&originWidth=1502&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1636386&status=done&style=none&taskId=u88d73e1f-ea4e-418e-9789-d6b3fd65daa&title=&width=751)
<a name="pa7T8"></a>
#### 2.3.3 相机配置

- 低ISO、高快门速度、大光圈、高像素。
- 相机类型（配合不同的IO及算法接口）。
- 畸变校准（参数获取）。

![](assets/post_images/Mixed-Virtual-Production/image_016.webp#clientId=u57957d9e-e995-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=OeoKH&margin=%5Bobject%20Object%5D&originHeight=432&originWidth=720&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ubc738fa7-40c9-4641-a529-1ee3eace453&title=)
<a name="cOf6u"></a>
#### 2.3.4 灯光布置

- 布光均匀。
- 灯光柔和扩散。
- 主体和绿幕分开打光。
<a name="hhl88"></a>
### 2.4 软件需要
<a name="fw00V"></a>
#### 2.4.1 离线后处理合成

- 抠图，后期软件+人工。
- 图层叠放。
- 特效及后处理。
- 生成动态模糊。
<a name="aosqS"></a>
#### 2.4.2 实时合成

- 去Montion Blur。
- 自动色键获取。
- 抠图和去溢色。
- 实时渲染及图层合并。
- 光影融合。
- 加Motion Blur。

<a name="smP18"></a>
## 3 基于Unreal 
<a name="A9oc1"></a>
### 3.1 实时合成
<a name="Jf3Fi"></a>
#### 3.1.1 Chroma Keying（抠图）

- RGB to YCoCg（[https://en.wikipedia.org/wiki/YCoCg](https://en.wikipedia.org/wiki/YCoCg)）

![](assets/post_images/Mixed-Virtual-Production/image_017.svg#clientId=u3279c955-d4b5-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u2a494eee&margin=%5Bobject%20Object%5D&originHeight=107&originWidth=309&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u1b455fb8-d3b9-42ba-bfd6-f3c017a2b9c&title=)![image.png](assets/post_images/Mixed-Virtual-Production/image_018.png#clientId=u3279c955-d4b5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=436&id=u47e6f004&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2390&originWidth=800&originalType=url&ratio=1&rotation=0&showTitle=false&size=2383259&status=done&style=none&taskId=u3caee2ba-9b4f-4db9-b7fe-bb67f93b8aa&title=&width=146)

- Chroma Mask multiplied by Luma

![image.png](assets/post_images/Mixed-Virtual-Production/image_019.png#clientId=u3279c955-d4b5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=934&id=u529f7b59&margin=%5Bobject%20Object%5D&name=image.png&originHeight=934&originWidth=1783&originalType=binary&ratio=1&rotation=0&showTitle=false&size=698682&status=done&style=none&taskId=u8e7748ad-0b75-4712-85bf-aa63577115f&title=&width=1783)

- SmoothStep

![image.png](assets/post_images/Mixed-Virtual-Production/image_020.png#clientId=u3279c955-d4b5-4&crop=0&crop=0&crop=1&crop=0.3578&from=paste&height=1199&id=u3edf8867&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1199&originWidth=623&originalType=binary&ratio=1&rotation=0&showTitle=false&size=408751&status=done&style=none&taskId=uceaa066b-7795-41c5-b3c5-71aaf74b68d&title=&width=623)![image.png](assets/post_images/Mixed-Virtual-Production/image_021.png#clientId=u3279c955-d4b5-4&crop=0&crop=0.658&crop=1&crop=1&from=paste&height=1199&id=u0debed4a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1199&originWidth=623&originalType=binary&ratio=1&rotation=0&showTitle=false&size=408751&status=done&style=none&taskId=ue3b0bd3d-34ee-4c37-9d2d-5fd685d6e8f&title=&width=623)
<a name="bgL8e"></a>
#### 3.1.2 Despill（去溢色）

- RGB to HSV
- Minus KeyColor Hue
- Smooth by Hue Range
- Lerp to Desaturation by Hue Diff

![image.png](assets/post_images/Mixed-Virtual-Production/image_022.png#clientId=u07ca26a8-5a08-4&crop=0&crop=0&crop=1&crop=0.3561&from=paste&height=1202&id=u54d3f252&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1202&originWidth=622&originalType=binary&ratio=1&rotation=0&showTitle=false&size=404528&status=done&style=none&taskId=uc2c26653-35e5-4071-b2d6-2f0d2035059&title=&width=622)![image.png](assets/post_images/Mixed-Virtual-Production/image_023.png#clientId=u07ca26a8-5a08-4&crop=0&crop=0.6614&crop=1&crop=1&from=paste&height=1202&id=u65bbedff&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1202&originWidth=622&originalType=binary&ratio=1&rotation=0&showTitle=false&size=404528&status=done&style=none&taskId=u533da177-4481-45d7-9af8-c3f520e615c&title=&width=622)
<a name="Msjfr"></a>
#### 3.1.3 前后景及切片

- 前景层对象捕获。
- 媒体流抠图及mask贴片。
- 背景实时渲染。
- 各种叠放逻辑进行合图。

![image.png](assets/post_images/Mixed-Virtual-Production/image_024.png#clientId=ubddb27b3-df19-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1090&id=u0a60d8d0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1090&originWidth=1224&originalType=binary&ratio=1&rotation=0&showTitle=false&size=646296&status=done&style=none&taskId=u318a9ec8-8ba6-47bc-a2fb-e238b1da564&title=&width=1224)<br />![image.png](assets/post_images/Mixed-Virtual-Production/image_025.png#clientId=u0dec3e3b-d024-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=903&id=ue1ddef64&margin=%5Bobject%20Object%5D&name=image.png&originHeight=903&originWidth=1964&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1677702&status=done&style=none&taskId=u20b34a76-1cfd-4a7a-936c-bdb751ba010&title=&width=1964)
<a name="fyZn0"></a>
#### 3.1.4 光影融合

<a name="scuW3"></a>
### 3.2 镜头及输入流
<a name="xxfuv"></a>
#### 3.2.1 镜头位置绑定
![image.png](assets/post_images/Mixed-Virtual-Production/image_026.png#clientId=u87bbbf1a-9c7b-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=718&id=ua5b99c35&margin=%5Bobject%20Object%5D&name=image.png&originHeight=718&originWidth=1924&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1815526&status=done&style=none&taskId=u50de4f2e-739b-49d8-97e7-e7b1b2e42ee&title=&width=1924)

- 入瞳点（entrance pupil)对齐保证无视差。
- 入瞳点测量。 [http://www.johnhpanos.com/epcalib.htm](http://www.johnhpanos.com/epcalib.htm)

![image.png](assets/post_images/Mixed-Virtual-Production/image_027.png#clientId=u87bbbf1a-9c7b-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=244&id=u62f0857a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1080&originWidth=774&originalType=binary&ratio=1&rotation=0&showTitle=false&size=983582&status=done&style=none&taskId=u0d42098e-cd0d-4e73-8f8c-be629bb7947&title=&width=175)![image.png](assets/post_images/Mixed-Virtual-Production/image_028.png#clientId=u87bbbf1a-9c7b-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=241&id=ucaf37159&margin=%5Bobject%20Object%5D&name=image.png&originHeight=986&originWidth=1901&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2171235&status=done&style=none&taskId=uf11d593e-c128-4a95-8aad-33bda68879c&title=&width=464)

- 启动Steam VR，链接Vive Tracker到电脑。
- 开启LiveLink，创建虚拟Tracker，并实时链接到C Vive。

![image.png](assets/post_images/Mixed-Virtual-Production/image_029.png#clientId=u87bbbf1a-9c7b-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=705&id=u88fd1597&margin=%5Bobject%20Object%5D&name=image.png&originHeight=705&originWidth=1308&originalType=binary&ratio=1&rotation=0&showTitle=false&size=817116&status=done&style=none&taskId=u55881efb-9d8d-4aa4-914a-97358207108&title=&width=1308)
<a name="XCXKH"></a>
#### 3.2.2 镜头畸变校准
![image.png](assets/post_images/Mixed-Virtual-Production/image_030.png#clientId=u17153e6d-fafc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1085&id=ua6bf3143&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1085&originWidth=1914&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1464336&status=done&style=none&taskId=u316ffb25-8863-4413-a2a6-bde5cddfc3a&title=&width=1914)<br />![image.png](assets/post_images/Mixed-Virtual-Production/image_031.png#clientId=u17153e6d-fafc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1083&id=u4ffc6f23&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1083&originWidth=1921&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1432373&status=done&style=none&taskId=u662118d6-3fe1-40a7-af48-24829209149&title=&width=1921)![pattern.png](assets/post_images/Mixed-Virtual-Production/image_032.png#clientId=u17153e6d-fafc-4&crop=0&crop=0&crop=1&crop=1&from=drop&id=ub3ea852d&margin=%5Bobject%20Object%5D&name=pattern.png&originHeight=1240&originWidth=1754&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27835&status=done&style=none&taskId=ue3ee435a-a228-454b-8e4a-43e294b3be7&title=)

- **悬垂线**在正常的物理镜头中，一般不会是完全竖直的。
- 相机拍摄模式、焦距、镜头、分辨率均会决定摄像头的畸变情况，任意调整需触发**重新校准**。
- 常用**棋盘格**来进行畸变参数计算采集，连续拍多组位置、角度不同的棋盘格相片，用CV的方法可以计算。
- **输入流矫正（REtracker Calibrator）**

![image.png](assets/post_images/Mixed-Virtual-Production/image_033.png#clientId=u17153e6d-fafc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1082&id=u0dbcf2a6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1082&originWidth=1921&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1019530&status=done&style=none&taskId=u9c995602-56a3-4c5f-95eb-d86f7d48a74&title=&width=1921)

- **虚拟相机逆矫正（LiveLinkXR & Calibration）**

![](assets/post_images/Mixed-Virtual-Production/image_034.gif#clientId=u17153e6d-fafc-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ubea3081b&margin=%5Bobject%20Object%5D&originHeight=738&originWidth=1064&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u8d102be5-167c-4b90-9298-1fd7c697d9a&title=)
<a name="iul6e"></a>
#### 3.2.3 专业采集卡

- AJA or BMD

![image.png](assets/post_images/Mixed-Virtual-Production/image_035.png#clientId=ubddb27b3-df19-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=783&id=u00122f4a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=783&originWidth=1185&originalType=binary&ratio=1&rotation=0&showTitle=false&size=610049&status=done&style=none&taskId=u01c3e452-2d0e-4a8b-87fa-f11a37b3ab8&title=&width=1185)<br />（[https://www.aja.com/products/kona-5-oem](https://www.aja.com/products/kona-5-oem)）

- AJA I/O or BlackMagic I/O software
- 时间码和集中同步，AJA或BlackMagic有对应的GenLock可以直接用，如果是非采集卡普通摄像头需要自己加。

<a name="eLAgB"></a>
## 4 缺陷与方向
<a name="Pc5ed"></a>
### 4.1 问题分析
完美的软硬件结合配合最高配置将使得整个流程输出的质量误差极小，然而实际过程中不会有那么多完美的状态，其中引入问题的关键点主要如下。
<a name="ZTbHC"></a>
#### 4.1.1 相机误差

- 相机参数不够好。
- 相机镜头畸变矫正错误。
- 相机存在的动态模糊不易消除，模式固定或快门速度不够。
- 相机与PC的I/O问题而引入的误差。
- 相机与PC或引擎软件的时间码同步出现问题。
<a name="DeozJ"></a>
#### 4.1.2 绿幕环境问题

- 灯光不够柔和。
- 绿幕表面被打亮的不够均匀。
- 人与绿幕间的反射、阴影影响。
<a name="RCC87"></a>
#### 4.1.3 抠图算法难点

- 基于色度的抠图，也会削弱主物体。
- 溢色难题。
- 参数自适应。
- 边缘融合。
<a name="HtSCf"></a>
#### 4.1.4 光影合成问题

- 虚拟阴影。
- 虚拟GI效果。
<a name="qMOmy"></a>
#### 4.1.5 虚实空间对应难

- 真实环境与虚拟空间尺寸难对应。
- 非绑Tracker的物体难定位。
- 物体运动带来的精度误差，同时对实时性也是挑战。
<a name="lkilt"></a>
### 4.2 相关Research
<a name="rkOG4"></a>
#### 4.2.1 背景分割
![image.png](assets/post_images/Mixed-Virtual-Production/image_036.png#clientId=u2b9a282e-6a4a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=202&id=u04861c18&margin=%5Bobject%20Object%5D&name=image.png&originHeight=404&originWidth=2026&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1054381&status=done&style=none&taskId=u10127d8d-4806-42cb-ac1e-ffd15a77471&title=&width=1013)[https://grail.cs.washington.edu/projects/background-matting/](https://grail.cs.washington.edu/projects/background-matting/)
<a name="Zvvph"></a>
#### 4.2.2 抠图和去溢色
![image.png](assets/post_images/Mixed-Virtual-Production/image_037.png#clientId=u2b9a282e-6a4a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=211&id=uf1755c99&margin=%5Bobject%20Object%5D&name=image.png&originHeight=422&originWidth=1406&originalType=binary&ratio=1&rotation=0&showTitle=false&size=635162&status=done&style=none&taskId=u10c4b511-f268-4218-94cc-d496c75b9c5&title=&width=703)<br />[http://yaksoy.github.io/keying/](http://yaksoy.github.io/keying/)
<a name="lXGb3"></a>
#### 4.2.3 单目相机姿态识别
![image.png](assets/post_images/Mixed-Virtual-Production/image_038.png#clientId=u2b9a282e-6a4a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=345&id=u92fcb1ff&margin=%5Bobject%20Object%5D&name=image.png&originHeight=690&originWidth=1332&originalType=binary&ratio=1&rotation=0&showTitle=false&size=795638&status=done&style=none&taskId=uc83ed21a-aabb-448f-8ba5-1fec2776b3a&title=&width=666)<br />[https://vcai.mpi-inf.mpg.de/projects/PhysCap/](https://vcai.mpi-inf.mpg.de/projects/PhysCap/)
<a name="Beg2K"></a>
### 4.3 整体解决方案
<a name="LhANv"></a>
####  4.3.1 Virtual Stage
![image.png](assets/post_images/Mixed-Virtual-Production/image_039.png#clientId=uc27945cb-ef56-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=485&id=u2e5833c8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=970&originWidth=2592&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2316953&status=done&style=none&taskId=uda8eced5-783f-400f-b6c9-58704630afa&title=&width=1296)<br />[https://www.microsoft.com/en-us/ai/ai-lab-virtual-stage](https://www.microsoft.com/en-us/ai/ai-lab-virtual-stage)
<a name="bcHZf"></a>
#### 4.3.2 视频算法抠图
参考钉钉、腾讯会议、FaceTime。
<a name="HRB8T"></a>
### 5 引用

- 《Interactive High-Quality Green-Screen Keying via Color Unmixing》 [http://yaksoy.github.io/keying/](http://yaksoy.github.io/keying/)
- 《Efficient mask expansion for green-screen keying using color distributions》[https://dl.acm.org/doi/abs/10.1145/3306214.3338595](https://dl.acm.org/doi/abs/10.1145/3306214.3338595)
- 《Human Instance Matting via Mutual Guidance and Multi-Instance Refinement》 [https://ieeexplore.ieee.org/document/9879184](https://ieeexplore.ieee.org/document/9879184)
- 《PhysCap: Physically Plausible Monocular 3D Motion Capture in Real Time》 [https://vcai.mpi-inf.mpg.de/projects/PhysCap/](https://vcai.mpi-inf.mpg.de/projects/PhysCap/)
- 《Despilling and Color Replacement》[https://learn.foundry.com/nuke/content/comp_environment/keying_with_chromakeyer/despill_controls.html](https://learn.foundry.com/nuke/content/comp_environment/keying_with_chromakeyer/despill_controls.html)
- 《Unreal实时合成入门课程》[https://dev.epicgames.com/community/learning/courses/eOD/unreal-engine-cf1068/jyB4/unreal-engine-44093a](https://dev.epicgames.com/community/learning/courses/eOD/unreal-engine-cf1068/jyB4/unreal-engine-44093a)
- 《在UE4中设置色键材质》[https://www.unrealengine.com/zh-CN/tech-blog/setting-up-a-chroma-key-material-in-ue4](https://www.unrealengine.com/zh-CN/tech-blog/setting-up-a-chroma-key-material-in-ue4)
- 《虚幻引擎文档》 [https://docs.unrealengine.com/4.27/zh-CN/](https://docs.unrealengine.com/4.27/zh-CN/)
- 《Virtual Production Tutorials,  by Greg Corson》 [https://www.youtube.com/playlist?list=PL4A6BJ4uPvvt1igHNPBNR3CeOsCLGyZ2U](https://www.youtube.com/playlist?list=PL4A6BJ4uPvvt1igHNPBNR3CeOsCLGyZ2U)
- 《虚拟制片实践指南》第一册、第二册 [虚拟制片指南第一册.pdf](https://yuque.antfin.com/attachments/lark/0/2022/pdf/223200/1666949482141-97a1695f-ba31-415b-9879-25aa57d17d17.pdf?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fyuque.antfin.com%2Fattachments%2Flark%2F0%2F2022%2Fpdf%2F223200%2F1666949482141-97a1695f-ba31-415b-9879-25aa57d17d17.pdf%22%2C%22name%22%3A%22%E8%99%9A%E6%8B%9F%E5%88%B6%E7%89%87%E6%8C%87%E5%8D%97%E7%AC%AC%E4%B8%80%E5%86%8C.pdf%22%2C%22size%22%3A20932905%2C%22type%22%3A%22application%2Fpdf%22%2C%22ext%22%3A%22pdf%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22mode%22%3A%22title%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22u6d52e7f8-e594-4e68-9836-19bbe1ae1f8%22%2C%22taskType%22%3A%22upload%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22u9531c776%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22card%22%3A%22file%22%7D)[《虚拟制片实践指南》第二册.pdf](https://yuque.antfin.com/attachments/lark/0/2022/pdf/223200/1666949486777-10af9d97-2d5e-44d5-a72b-9b6c5430f139.pdf?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fyuque.antfin.com%2Fattachments%2Flark%2F0%2F2022%2Fpdf%2F223200%2F1666949486777-10af9d97-2d5e-44d5-a72b-9b6c5430f139.pdf%22%2C%22name%22%3A%22%E3%80%8A%E8%99%9A%E6%8B%9F%E5%88%B6%E7%89%87%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97%E3%80%8B%E7%AC%AC%E4%BA%8C%E5%86%8C.pdf%22%2C%22size%22%3A24601037%2C%22type%22%3A%22application%2Fpdf%22%2C%22ext%22%3A%22pdf%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22mode%22%3A%22title%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22u22192589-dece-4ae0-903e-fb98ba7dc8d%22%2C%22taskType%22%3A%22upload%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22ua911cfc7%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22card%22%3A%22file%22%7D)
- 《单反科普专栏》 [https://zhuanlan.zhihu.com/p/46716827](https://zhuanlan.zhihu.com/p/46716827)

